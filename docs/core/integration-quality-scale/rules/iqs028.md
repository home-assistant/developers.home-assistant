---
title: "IQS028 - If making HTTP requests, support passing in websession"
---

IQS028 is as follows:

If making HTTP requests, support passing in websession

## Reasoning

Since a lot of devices and services are connected to via HTTP, the amount of websessions that are active can be a lot.
To improve the efficiency of those websessions, it is recommended to support passing in a websession.
These sessions are tweaked towards being used in Home Assistant and is more efficient.

Home Assistants supports this for `aiohttp` and `httpx`.

## Example implementation

In the example below, a `aiohttp` session is passed in to the client.
The equivalent for `httpx` would be `get_async_client`.

```python
async def async_setup_entry(hass: HomeAssistant, entry: MyConfigEntry) -> bool:
    """Set up my integration from a config entry."""

    client = MyClient(entry.data[CONF_HOST], async_get_clientsession(hass))
```

:::info
There are cases where you might not want a shared session, for example when cookies are used.
In that case, you can create a new session using `async_create_clientsession` for `aiohttp` and `create_async_httpx_client` for `httpx`.
:::

## Additional resources


## Exceptions

There are no exceptions to this rule.

## Related rules

- IQS027 - Dependency is async